# Topic Generator

This is a Java program that generates topics for public Dockstore entries using AI.

The [entries.csv](entries.csv) file contains the TRS ID and default versions of public Dockstore entries to generate topics for. The [results](results) directory contains the generated topics for those entries from running the topic generator. 

## Setup

### Configuration file

Create a configuration file like the following. A template `topic-generator.config` file can be found [here](templates/topic-generator.config).

```
[dockstore]
server-url: <Dockstore server url>
token: <Dockstore admin or curator token>
```

**Required:**
- `server-url`: The Dockstore server URL that's used to send API requests to.
    - Examples:
        - `https://qa.dockstore.org/api`
        - `https://staging.dockstore.org/api`
        - `https://dockstore.org/api`
- `token`: The Dockstore token of an admin or curator. This token is used to upload topics to the webservice.

### Authentication to invoke AI models

#### AWS Bedrock

By default, the program uses AWS Bedrock to invoke the Anthropic Claude 3 Haiku model to generate topics. 
AWS credentials that have permissions to use the AWS Bedrock API are required and they must have access to the Anthropic Claude models on AWS.
There are several ways that this can be provided.
Read [this](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/credentials.html#credentials-chain) for the default credential provider chain.


#### OpenAI (deprecated)

We have moved away from using OpenAI models to generate topics, but if you wish to use it, you need to add the following section to your configuration file.
See https://platform.openai.com/docs/api-reference/authentication for more details.

```
[ai]
openai-api-key: <OpenAI API key>
```

## Running the program

```
Usage: <main class> [options] [command] [command options]
  Options:
    -c, --config
      The config file path.
      Default: ./topic-generator.config
    --help
      Prints help for topicgenerator
  Commands:
    generate-topics      Generate topics for public Dockstore entries using 
            AI. Use the upload-topics command to upload these topics to 
            Dockstore. 
      Usage: generate-topics [options]
        Options:
          -a, --ai
            The AI model to use
            Default: CLAUDE_3_HAIKU
            Possible Values: [CLAUDE_3_5_SONNET, CLAUDE_3_HAIKU, GPT_4O_MINI]
          -d, --dryRun
            Write the public Dockstore entries that are AI topic candidates to 
            a file
            Default: false
          -e, --entries
            Optional file path to the CSV file containing the TRS ID, and 
            version name of the entries to generate topics for. The first line 
            of the file should contain the CSV fields: trsID,version
          -m, --max
            The max number of entries to process. If specified, the value must 
            be greater than 0

    upload-topics      Upload AI topics, generated by the generate-topics 
            command, for public Dockstore entries.
      Usage: upload-topics [options]
        Options:
        * -ai, --aiTopics
            The file path to the CSV file containing the TRS ID, and AI topics 
            of the entries to upload topics for. The first line of the file 
            should contain the CSV fields: trsId,aiTopic. The output file 
            generated by the generate-topics command can be used as the 
            argument.
```

### generate-topics

**Using the default configuration file path and performing a dry run:**

This command will write all the AI topic candidates that it will generate topics for to a file. It will not generate any topics.

`java -jar target/topicgenerator-*-SNAPSHOT.jar generate-topics --dryRun`

**Using the default configuration file path and retrieving entries from Dockstore:**  

This command generates topics for all AI topic candidates in Dockstore. 

`java -jar target/topicgenerator-*-SNAPSHOT.jar generate-topics`

**Using the default configuration file path and retrieving a specified number of entries from Dockstore:**

This command generates topics for a specified number of AI topic candidates in Dockstore.

`java -jar target/topicgenerator-*-SNAPSHOT.jar generate-topics --max 10`

**Using a custom configuration file path and custom entries input path:**

This command generates topics for the entries specified in the input path.

`java -jar target/topicgenerator-*-SNAPSHOT.jar --config my-custom-config generate-topics --entries my-custom-entries.csv`

### upload-topics

This command is meant to be used to upload the AI topics generated by the [generate-topics](#generate-topics) command.

**Using the default configuration file path and a custom AI topics input path:**

`java -jar target/topicgenerator-*-SNAPSHOT.jar upload-topics --aiTopics generated-ai-topics.csv`

**Using a custom configuration file path and AI topics input path:**

`java -jar target/topicgenerator-*-SNAPSHOT.jar --config my-custom-config upload-topics --aiTopics generated-ai-topics.csv`